<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sign Up</title>

  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 text-gray-800">

  <main class="flex items-center justify-center mt-20">

    <section class="bg-white shadow-sm h-[600px] w-[400px] rounded-xl flex flex-col items-center justify-start p-6 border border-gray-200">

      <h1 class="font-semibold text-2xl text-gray-700 mb-6">
        Create account
      </h1>

      <form id="signupForm" action="/signup" method="post" class="flex flex-col gap-3 w-full">

        <!-- Email -->
        <label class="text-sm text-gray-600 font-medium">Email</label>
        <input
          type="email"
          id="email"
          name="email"
          required
          placeholder="you@example.com"
          class="rounded-md p-3 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
        />

        <!-- Username -->
        <label class="text-sm text-gray-600 font-medium">Username</label>
        <input
          type="text"
          id="username"
          name="username"
          required
          placeholder="your username"
          class="rounded-md p-3 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
        />

        <!-- Password -->
        <label class="text-sm text-gray-600 font-medium">Password</label>
        <input
          type="password"
          id="password"
          name="password"
          required
          placeholder="Create a strong password"
          class="rounded-md p-3 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
        />

        <!-- Confirm Password -->
        <label class="text-sm text-gray-600 font-medium">Confirm Password</label>
        <input
          type="password"
          id="confirmPassword"
          required
          placeholder="Repeat your password"
          class="rounded-md p-3 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
        />

        <!-- Validation message -->
        <p id="message" class="text-xs mt-1"></p>

        <div id="signupMessage" class="w-full text-sm text-center mt-2 hidden" role="status" aria-live="polite"></div>

        <button
          type="submit"
          class="bg-blue-600 hover:bg-blue-700 w-full p-3 mt-2 text-white text-sm font-semibold rounded-md transition"
        >
          Sign up
        </button>
      </form>

      <!-- Login link -->
      <div class="mt-6 text-sm text-gray-600">
        Already have an account?
        <a href="/" class="text-blue-600 font-medium hover:underline ml-1">
          Log in
        </a>
      </div>

    </section>
  </main>

    <!-- JS VALIDATION + AJAX SUBMIT -->
  <script>
    const form = document.getElementById("signupForm");
    const password = document.getElementById("password");
    const confirmPassword = document.getElementById("confirmPassword");
    const message = document.getElementById("message");
    const signupMessage = document.getElementById("signupMessage");

    function isStrongPassword(pw) {
      return (
        pw.length >= 8 &&
        /[A-Z]/.test(pw) &&
        /[a-z]/.test(pw) &&
        /[0-9]/.test(pw) &&
        /[^A-Za-z0-9]/.test(pw)
      );
    }

    function showSignupMessage(text, type = 'error') {
      signupMessage.classList.remove('hidden','text-red-600','text-green-600','bg-red-50','bg-green-50','border-red-200','border-green-200');
      signupMessage.textContent = text;
      if (type === 'success') {
        signupMessage.classList.add('text-green-600','bg-green-50','border','border-green-200','p-2','rounded-md');
      } else {
        signupMessage.classList.add('text-red-600','bg-red-50','border','border-red-200','p-2','rounded-md');
      }
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      // Clear backend message
      signupMessage.className = 'w-full text-sm text-center mt-2 hidden';
      signupMessage.textContent = '';

      // Client-side validation
      if (!isStrongPassword(password.value)) {
        message.textContent =
          "Password must be at least 8 characters, include uppercase, lowercase, number, and symbol.";
        message.className = "text-xs text-red-500";
        return;
      }

      if (password.value !== confirmPassword.value) {
        message.textContent = "Passwords do not match.";
        message.className = "text-xs text-red-500";
        return;
      }

      message.textContent = "Account ready to be created âœ”";
      message.className = "text-xs text-green-600";

      // Prepare and send via fetch to backend
      const formData = new FormData(form);

      try {
        const response = await fetch(form.action || '/signup', {
          method: form.method || 'POST',
          body: formData,
          credentials: 'same-origin'
        });

        const data = await response.json();

        if (data.status === 'success') {
          showSignupMessage(data.message || 'Account created', 'success');
          // short delay then redirect (adjust target as needed)
          setTimeout(() => { window.location.href = '/'; }, 600);
          return;
        }

        // error from backend
        showSignupMessage(data.message || 'Signup failed', 'error');
        alert(data.message || 'Signup failed');

      } catch (err) {
        console.error('Signup request error:', err);
        showSignupMessage('Network error. Please try again.', 'error');
        alert('Network error. Please try again.');
      }
    });
  </script>

</body>
</html>